<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Data Structures · JUDI documentation</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">JUDI documentation</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../about/">About</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../basics/">Getting Started</a></li><li><span class="tocitem">JUDI API</span><ul><li><a class="tocitem" href="../abstract_vectors/">Abstract vectors</a></li><li class="is-active"><a class="tocitem" href>Data Structures</a><ul class="internal"><li><a class="tocitem" href="#Physical-Parameter"><span>Physical Parameter</span></a></li><li><a class="tocitem" href="#Model-structure"><span>Model structure</span></a></li><li><a class="tocitem" href="#Geometry-structure"><span>Geometry structure</span></a></li><li><a class="tocitem" href="#Options-structure"><span>Options structure</span></a></li></ul></li><li><a class="tocitem" href="../linear_operators/">Linear Operators</a></li><li><a class="tocitem" href="../preconditioners/">Preconditioners</a></li><li><a class="tocitem" href="../io/">Input/Output</a></li><li><a class="tocitem" href="../helper/">Helper Functions</a></li></ul></li><li><a class="tocitem" href="../inversion/">Inversion</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../tutorials/01_intro/">Introduction to JUDI</a></li><li><a class="tocitem" href="../tutorials/02_fwi_example_NLopt/">FWI with Quasi-Newton methods from the NLopt library</a></li><li><a class="tocitem" href="../tutorials/03_constrained_fwi/">FWI Example</a></li><li><a class="tocitem" href="../tutorials/04_judi_leading_edge_tutorial/">Full-Waveform Inversion - Part 3: optimization</a></li><li><a class="tocitem" href="../tutorials/05_custom_misfit/">FWI with user provided misfit function</a></li><li><a class="tocitem" href="../tutorials/06_automatic_differentiation/">Automatic differentiation with JUDI</a></li><li><a class="tocitem" href="../tutorials/07_preconditionners/">Seismic preconditionners</a></li><li><a class="tocitem" href="../tutorials/imaging_conditions/">Imaging conditions in JUDI</a></li><li><a class="tocitem" href="../tutorials/quickstart/">Modeling and inversion with JUDI</a></li></ul></li><li><a class="tocitem" href="../pysource/">Devito backend reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">JUDI API</a></li><li class="is-active"><a href>Data Structures</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Data Structures</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/slimgroup/JUDI.jl/blob/master/docs/src/data_structures.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Data-structures"><a class="docs-heading-anchor" href="#Data-structures">Data structures</a><a id="Data-structures-1"></a><a class="docs-heading-anchor-permalink" href="#Data-structures" title="Permalink"></a></h1><ul><li><a href="#Data-structures">Data structures</a></li><ul><li><a href="#Physical-Parameter">Physical Parameter</a></li><li><a href="#Model-structure">Model structure</a></li><li><a href="#Geometry-structure">Geometry structure</a></li><li><a href="#Options-structure">Options structure</a></li></ul></ul><h2 id="Physical-Parameter"><a class="docs-heading-anchor" href="#Physical-Parameter">Physical Parameter</a><a id="Physical-Parameter-1"></a><a class="docs-heading-anchor-permalink" href="#Physical-Parameter" title="Permalink"></a></h2><p>Data structure for physical parameter array in JUDI. A <code>PhysicalParameter</code> inherits from julia <code>AbstractVector</code></p><article class="docstring"><header><a class="docstring-binding" id="JUDI.PhysicalParameter" href="#JUDI.PhysicalParameter"><code>JUDI.PhysicalParameter</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">PhysicalParameter
    n::NTuple{N, T}
    d::NTuple{N, Tf}
    o::NTuple{N, Tf}
    data::Union{Array, Number}</code></pre><p>PhysicalParameter structure for physical space parameter.</p><p><code>n</code>: number of gridpoints in (x,y,z) for 3D or (x,z) for 2D</p><p><code>d</code>: grid spacing in (x,y,z) or (x,z) (in meters)</p><p><code>o</code>: origin of coordinate system in (x,y,z) or (x,z) (in meters)</p><p><code>data</code>: the array of the parameter values of size n</p><p><strong>Constructor</strong></p><p>A <code>PhysicalParameter</code> can be constructed in various ways but always require the origin <code>o</code> and grid spacing <code>d</code> that cannot be infered from the array.</p><pre><code class="language-none">PhysicalParameter(v::Array{T}, d, o) where `v` is an n-dimensional array and n=size(v)

PhysicalParameter(n, d, o; T=Float32) Creates a zero PhysicalParameter

PhysicalParameter(v::Array{T}, A::PhysicalParameter{T, N}) where {T&lt;:Real, N} Creates a PhysicalParameter from the Array `v` with n, d, o from `A`

PhysicalParameter(v::Array{T, N}, n::NTuple{N, T}, d::NTuple{N, T}, o::Tuple) where `v` is a vector or nd-array that is reshaped into shape `n`

PhysicalParameter(v::T, n::NTuple{N, T}, d::NTuple{N, T}, o::Tuple) Creates a constant (single number) PhyicalParameter</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slimgroup/JUDI.jl/blob/ca7c08a59ee80a18fe7e690d77e5aaa0f7080833/src/TimeModeling/Types/ModelStructure.jl#L30-L63">source</a></section></article><p>Unless specified otherwise with the <code>return_array</code> option in <a href="#JUDI.Options"><code>Options</code></a>, the result of a migration/FWIgradient(<a href="../linear_operators/#JUDI.judiJacobian"><code>judiJacobian</code></a>, <a href="../inversion/#JUDI.fwi_objective"><code>fwi_objective</code></a>, <a href="../inversion/#JUDI.lsrtm_objective"><code>lsrtm_objective</code></a>) will be wrapped into a <code>PhysicalParameter</code>. THis allow better handling of different model parts and a better representation of the dimensional array.</p><h2 id="Model-structure"><a class="docs-heading-anchor" href="#Model-structure">Model structure</a><a id="Model-structure-1"></a><a class="docs-heading-anchor-permalink" href="#Model-structure" title="Permalink"></a></h2><p>Data structure for velocity models in JUDI.</p><article class="docstring"><header><a class="docstring-binding" id="JUDI.Model" href="#JUDI.Model"><code>JUDI.Model</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">Model(n, d, o, m; epsilon=nothing, delta=nothing, theta=nothing,
        phi=nothing, rho=nothing, qp=nothing, vs=nothing, nb=40)</code></pre><p>The parameters <code>n</code>, <code>d</code>, <code>o</code> and <code>m</code> are mandatory, whith <code>nb</code> and other physical parameters being optional input arguments.</p><p>where</p><p><code>m</code>: velocity model in slowness squared (s^2/km^2)</p><p><code>epsilon</code>: Epsilon thomsen parameter ( between -1 and 1)</p><p><code>delta</code>: Delta thomsen parameter ( between -1 and 1 and delta &lt; epsilon)</p><p><code>theta</code>: Anisotopy dip in radian</p><p><code>phi</code>: Anisotropy asymuth in radian</p><p><code>rho</code>: density (g / m^3)</p><p><code>qp</code>: P-wave attenuation for visco-acoustic models</p><p><code>vs</code>: S-wave velocity for elastic models.</p><p><code>nb</code>: Number of ABC points</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slimgroup/JUDI.jl/blob/ca7c08a59ee80a18fe7e690d77e5aaa0f7080833/src/TimeModeling/Types/ModelStructure.jl#L326-L353">source</a></section></article><p>Accessible fields include all of the above parameters <code>p.n, p.d, p.o, p.data</code>. Additionaly, arithmetic operation are all impemented such as addition, multiplication, broadcasting and indexing. Linear algebra operation are implemented as well but will return a standard Julia vector if the matrix used is external to JUDI.</p><p><strong>Access fields:</strong></p><p>Accessible fields include all of the above parameters, which can be accessed as follows:</p><pre><code class="language-julia"># Access model
model.m

# Access number of grid points
model.n</code></pre><h2 id="Geometry-structure"><a class="docs-heading-anchor" href="#Geometry-structure">Geometry structure</a><a id="Geometry-structure-1"></a><a class="docs-heading-anchor-permalink" href="#Geometry-structure" title="Permalink"></a></h2><p>JUDI&#39;s geometry structure contains the information of either the source <strong>or</strong> the receiver geometry. Construct an (in-core) geometry object for <strong>either</strong> a source or receiver set up:</p><article class="docstring"><header><a class="docstring-binding" id="JUDI.Geometry" href="#JUDI.Geometry"><code>JUDI.Geometry</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">GeometryIC
    xloc::Array{Array{T, 1},1}
    yloc::Array{Array{T, 1},1}
    zloc::Array{Array{T, 1},1}
    t::Vector{StepRangeLen{T}}</code></pre><p>Geometry structure for seismic sources or receivers. Each field is a cell array, where individual cell entries contain values or arrays with coordinates and sampling information for the corresponding shot position. The  first three entries are in meters and the last three entries in milliseconds.</p><pre><code class="language-none">GeometryOOC{T} &lt;: Geometry{T}
    container::Array{SegyIO.SeisCon,1}
    t::Vector{StepRangeLen{T}}
    nrec::Array{Integer,1}
    key::String
    segy_depth_key::String</code></pre><p><strong>Constructors</strong></p><p>Only pass <code>dt</code> and <code>n</code> and automatically set <code>t</code>:</p><pre><code class="language-none">Geometry(xloc, yloc, zloc; dt=[], nt=[])</code></pre><p>Pass single array as coordinates/parameters for all <code>nsrc</code> experiments:</p><pre><code class="language-none">Geometry(xloc, yloc, zloc, dt=[], nt=[], nsrc=1)</code></pre><p>Create geometry structure for either source or receivers from a SegyIO.SeisBlock object. <code>segy_depth_key</code> is the SegyIO keyword that contains the depth coordinate and <code>key</code> is  set to either <code>source</code> for source geometry or <code>receiver</code> for receiver geometry:</p><pre><code class="language-none">Geometry(SeisBlock; key=&quot;source&quot;, segy_depth_key=&quot;&quot;)</code></pre><p>Create geometry structure for from a SegyIO.SeisCon object (seismic data container):</p><pre><code class="language-none">Geometry(SeisCon; key=&quot;source&quot;, segy_depth_key=&quot;&quot;)</code></pre><p><strong>Examples</strong></p><p>(1) Set up receiver geometry for 2D experiment with 4 source locations and 80 fixed receivers:</p><pre><code class="language-none">xrec = range(100,stop=900,length=80)
yrec = range(0,stop=0,length=80)
zrec = range(50,stop=50,length=80)
dt = 4f0
t = 1000f0

rec_geometry = Geometry(xrec, yrec, zrec; dt=dt, t=t, nsrc=4)</code></pre><p>(2) Set up corresponding source geometry (coordinates can be of type <code>linspace</code> or regular arrays):</p><pre><code class="language-none">xsrc = [200,400,600,800]
ysrc = [0,0,0,0]
zsrc = [50,50,50,50]

src_geometry = Geometry(xsrc, ysrc, zsrc; dt=dt, t=t, nsrc=4)</code></pre><p>(3) Read source and receiver geometries from SEG-Y file:</p><pre><code class="language-none">using SegyIO
seis_block = segy_read(&quot;test_file.segy&quot;)
rec_geometry = Geometry(seis_block; key=&quot;receiver&quot;, segy_depth_key=&quot;RecGroupElevation&quot;)
src_geometry = Geometry(seis_block; key=&quot;source&quot;, segy_depth_key=&quot;SourceDepth&quot;)</code></pre><p>Check the seis_block&#39;s header entries to findall out which keywords contain the depth coordinates. The source depth keyword is either <code>SourceDepth</code> or <code>SourceSurfaceElevation</code>. The receiver depth  keyword is typically <code>RecGroupElevation</code>.</p><p>(4) Read source and receiver geometries from out-of-core SEG-Y files (for large data sets). Returns an out-of-core  geometry object <code>GeometryOOC</code> without the source/receiver coordinates, but a lookup table instead:</p><pre><code class="language-none">using SegyIO
seis_container = segy_scan(&quot;/path/to/data/directory&quot;,&quot;filenames&quot;,[&quot;GroupX&quot;,&quot;GroupY&quot;,&quot;RecGroupElevation&quot;,&quot;SourceDepth&quot;,&quot;dt&quot;])
rec_geometry = Geometry(seis_container; key=&quot;receiver&quot;, segy_depth_key=&quot;RecGroupElevation&quot;)
src_geometry = Geometry(seis_container; key=&quot;source&quot;, segy_depth_key=&quot;SourceDepth&quot;)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slimgroup/JUDI.jl/blob/ca7c08a59ee80a18fe7e690d77e5aaa0f7080833/src/TimeModeling/Types/GeometryStructure.jl#L92-L171">source</a></section></article><p>From the optional arguments, you have to pass (at least) <strong>two</strong> of <code>dt</code>, <code>nt</code> and <code>t</code>. The third value is automatically determined and set from the two other values. a <code>Geometry</code> can be constructed in a number of different ways for in-core and out-of-core cases. Check our examples and the source for additional details while the documentation is being extended.</p><p><strong>Access fields:</strong></p><p>Accessible fields include all of the above parameters, which can be accessed as follows:</p><pre><code class="language-julia"># Access cell arrays of x coordinates:
geometry.xloc

# Access x coordinates of the i-th source location
geometry.xloc[i]

# Access j-th receiver location (in x) of the i-th source location
geometry.xloc[i][j]</code></pre><h3 id="Geometry-utilities"><a class="docs-heading-anchor" href="#Geometry-utilities">Geometry utilities</a><a id="Geometry-utilities-1"></a><a class="docs-heading-anchor-permalink" href="#Geometry-utilities" title="Permalink"></a></h3><p>A few utilities to manipulates geometries are provided as well.</p><article class="docstring"><header><a class="docstring-binding" id="JUDI.super_shot_geometry" href="#JUDI.super_shot_geometry"><code>JUDI.super_shot_geometry</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">super_shot_geometry(Geometry)</code></pre><p>Merge all the sub-geometries <code>1:get_nsrc(Geometry)</code> into a single supershot geometry</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slimgroup/JUDI.jl/blob/ca7c08a59ee80a18fe7e690d77e5aaa0f7080833/src/TimeModeling/Types/GeometryStructure.jl#L556-L560">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="JUDI.reciprocal_geom" href="#JUDI.reciprocal_geom"><code>JUDI.reciprocal_geom</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">reciprocal_geom(sourceGeom, recGeom)</code></pre><p>Applies reciprocity to the par of geometries <code>sourceGeom</code> and <code>recGeom</code> where each source becomes a receiver and each receiver becomes a source.</p><p>This method expects:</p><ul><li>Both geometries to be In Core. If the geometries are OOC they will be converted to in core geometries</li><li>The metadata to be compatible. In details all the time sampling rates (dt) and recording times (t) must be the same</li><li>The source to be single point sources. This method will error if a simultaneous sources (multiple poisiton for a single source) are used.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slimgroup/JUDI.jl/blob/ca7c08a59ee80a18fe7e690d77e5aaa0f7080833/src/TimeModeling/Types/GeometryStructure.jl#L569-L579">source</a></section></article><h2 id="Options-structure"><a class="docs-heading-anchor" href="#Options-structure">Options structure</a><a id="Options-structure-1"></a><a class="docs-heading-anchor-permalink" href="#Options-structure" title="Permalink"></a></h2><p>The options structure allows setting several modeling parameters.</p><article class="docstring"><header><a class="docstring-binding" id="JUDI.Options" href="#JUDI.Options"><code>JUDI.Options</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">JUDIOptions
    space_order::Integer
    free_surface::Bool
    limit_m::Bool
    buffer_size::AbstractFloat
    save_rate::AbstractFloat
    save_data_to_disk::Bool
    file_path::String
    file_name::String
    sum_padding::Bool
    optimal_checkpointing::Bool
    frequencies::Array
    IC::String
    subsampling_factor::Integer
    dft_subsampling_factor::Integer
    return_array::Bool
    dt_comp::Real
    f0::Real</code></pre><p>Options structure for seismic modeling.</p><p><code>space_order</code>: finite difference space order for wave equation (default is 8, needs to be multiple of 4)</p><p><code>free_surface</code>: set to <code>true</code> to enable a free surface boundary condition.</p><p><code>limit_m</code>: for 3D modeling, limit modeling domain to area with receivers (saves memory)</p><p><code>buffer_size</code>: if <code>limit_m=true</code>, define buffer area on each side of modeling domain (in meters)</p><p><code>save_data_to_disk</code>: if <code>true</code>, saves shot records as separate SEG-Y files</p><p><code>file_path</code>: path to directory where data is saved</p><p><code>file_name</code>: shot records will be saved as specified file name plus its source coordinates</p><p><code>sum_padding</code>: when removing the padding area of the gradient, sum into boundary rows/columns for true adjoints</p><p><code>optimal_checkpointing</code>: instead of saving the forward wavefield, recompute it using optimal checkpointing</p><p><code>frequencies</code>: calculate the FWI/LS-RTM gradient in the frequency domain for a given set of frequencies</p><p><code>subsampling_factor</code>: compute forward wavefield on a time axis that is reduced by a given factor (default is 1)</p><p><code>dft_subsampling_factor</code>: compute on-the-fly DFTs on a time axis that is reduced by a given factor (default is 1)</p><p><code>IC</code>: Imaging condition. Options are &#39;as, isic, fwi&#39; with &quot;as&quot; for adjoint state, isic for the inverse scattering imaging condition and FWI for the complement of isic (i.e isic + fwi = as)</p><p><code>isic</code>: Inverse scattering imaging condition. Deprecated, use <code>IC=&quot;isic&quot;</code> instead.</p><p><code>return_array</code>: return data from nonlinear/linear modeling as a plain Julia array.</p><p><code>dt_comp</code>: overwrite automatically computed computational time step with this value.</p><p><code>f0</code>: define peak frequency.</p><p><strong>Constructor</strong></p><p>All arguments are optional keyword arguments with the following default values:</p><pre><code class="language-none">Options(;space_order=8, free_surface=false,
        limit_m=false, buffer_size=1e3,
        save_data_to_disk=false, file_path=&quot;&quot;,
        file_name=&quot;shot&quot;, sum_padding=false,
        optimal_checkpointing=false,
        num_checkpoints=nothing, checkpoints_maxmem=nothing,
        frequencies=[], isic=false,
        subsampling_factor=1, dft_subsampling_factor=1, return_array=false,
        dt_comp=nothing, f0=0.015f0)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/slimgroup/JUDI.jl/blob/ca7c08a59ee80a18fe7e690d77e5aaa0f7080833/src/TimeModeling/Types/OptionsStructure.jl#L28-L101">source</a></section></article><p><strong>notes</strong></p><p><code>Option</code> has been renamed <code>JUDIOptions</code> as of JUDI version <code>4.0</code> to avoid potential (and exisiting) conflicts wiht other packages exporting an Options structure.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../abstract_vectors/">« Abstract vectors</a><a class="docs-footer-nextpage" href="../linear_operators/">Linear Operators »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 3 June 2024 16:40">Monday 3 June 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
