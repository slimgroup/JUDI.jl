<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Input/Output · JUDI documentation</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">JUDI documentation</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../about/">About</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../basics/">Getting Started</a></li><li><span class="tocitem">JUDI API</span><ul><li><a class="tocitem" href="../abstract_vectors/">Abstract vectors</a></li><li><a class="tocitem" href="../data_structures/">Data Structures</a></li><li><a class="tocitem" href="../linear_operators/">Linear Operators</a></li><li><a class="tocitem" href="../preconditioners/">Preconditioners</a></li><li class="is-active"><a class="tocitem" href>Input/Output</a><ul class="internal"><li><a class="tocitem" href="#Reading-SEG-Y-files-into-memory"><span>Reading SEG-Y files into memory</span></a></li><li><a class="tocitem" href="#Writing-SEG-Y-files"><span>Writing SEG-Y files</span></a></li><li><a class="tocitem" href="#Reading-out-of-core-SEG-Y-files"><span>Reading out-of-core SEG-Y files</span></a></li><li><a class="tocitem" href="#Reading-and-writing-velocity-models"><span>Reading and writing velocity models</span></a></li></ul></li><li><a class="tocitem" href="../helper/">Helper Functions</a></li></ul></li><li><a class="tocitem" href="../inversion/">Inversion</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../tutorials/01_intro/">Introduction to JUDI</a></li><li><a class="tocitem" href="../tutorials/02_fwi_example_NLopt/">FWI with Quasi-Newton methods from the NLopt library</a></li><li><a class="tocitem" href="../tutorials/03_constrained_fwi/">FWI Example</a></li><li><a class="tocitem" href="../tutorials/04_judi_leading_edge_tutorial/">Full-Waveform Inversion - Part 3: optimization</a></li><li><a class="tocitem" href="../tutorials/05_custom_misfit/">FWI with user provided misfit function</a></li><li><a class="tocitem" href="../tutorials/06_automatic_differentiation/">Automatic differentiation with JUDI</a></li><li><a class="tocitem" href="../tutorials/07_preconditionners/">Seismic preconditionners</a></li><li><a class="tocitem" href="../tutorials/imaging_conditions/">Imaging conditions in JUDI</a></li><li><a class="tocitem" href="../tutorials/quickstart/">Modeling and inversion with JUDI</a></li></ul></li><li><a class="tocitem" href="../pysource/">Devito backend reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">JUDI API</a></li><li class="is-active"><a href>Input/Output</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Input/Output</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/slimgroup/JUDI.jl/blob/master/docs/src/io.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Input/Output"><a class="docs-heading-anchor" href="#Input/Output">Input/Output</a><a id="Input/Output-1"></a><a class="docs-heading-anchor-permalink" href="#Input/Output" title="Permalink"></a></h1><p>For reading and writing SEG-Y data, JUDI uses the <a href="https://github.com/slimgroup/SegyIO.jl">SegyIO.jl</a> package. JUDI supports reading SEG-Y from disk into memory, as well as working with out-of-core (OOC) data containers. In the latter case, <code>judiVectors</code> contain look-up tables that allow accessing the underlying data in constant time.</p><h2 id="Reading-SEG-Y-files-into-memory"><a class="docs-heading-anchor" href="#Reading-SEG-Y-files-into-memory">Reading SEG-Y files into memory</a><a id="Reading-SEG-Y-files-into-memory-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-SEG-Y-files-into-memory" title="Permalink"></a></h2><p>To read a single SEG-Y file into memory, use the <code>segy_read</code> function:</p><pre><code class="language-julia">using SegyIO

block = segy_read(&quot;data.segy&quot;)</code></pre><p>From a <code>SegyIO</code> data block, you can create an in-core <code>judiVector</code>, as well as a <code>Geometry</code> object for the source:</p><pre><code class="language-none"># judiVector for observed data
d_obs = judiVector(block; segy_depth_key=&quot;RecGroupElevation&quot;)

# Source geometry
src_geometry = Geometry(block; key=&quot;source&quot;, segy_depth_key=&quot;SourceDepth&quot;)</code></pre><p>The optional keyword <code>segy_depth_key</code> specifies which SEG-Y header stores the depth coordinate. After reading a <code>block</code>, you can check <code>block.traceheaders</code> to see which trace headers are set and where to find the depth coordinates for sources or receivers.</p><p>The <code>d_obs</code> vector constains the receiver geometry in <code>d_obs.geometry</code>, so there is no need to set up a separate geometry object manually. However, in principle we can set up a receiver <code>Geometry</code> object as follows:</p><pre><code class="language-none">rec_geometry = Geometry(block; key=&quot;receiver&quot;, segy_depth_key=&quot;RecGroupElevation&quot;)</code></pre><h2 id="Writing-SEG-Y-files"><a class="docs-heading-anchor" href="#Writing-SEG-Y-files">Writing SEG-Y files</a><a id="Writing-SEG-Y-files-1"></a><a class="docs-heading-anchor-permalink" href="#Writing-SEG-Y-files" title="Permalink"></a></h2><p>To write a <code>judiVector</code> as a SEG-Y file, we need a <code>judiVector</code> containing the receiver data and geometry, as well as a <code>judiVector</code> with the source coordinates. From the <code>judiVectors</code>, we first create a <code>SegyIO</code> block:</p><pre><code class="language-julia">block = judiVector_to_SeisBlock(d_obs, q)</code></pre><p>where <code>d_obs</code> and <code>q</code> are <code>judiVectors</code> for receiver and source data respectively. To save only the source <code>q</code>, we can do</p><pre><code class="language-julia">block = src_to_SeisBlock(q)</code></pre><p>Next, we can write a SEG-Y file from a <code>SegyIO block</code>:</p><pre><code class="language-julia">segy_write(&quot;new_file.segy&quot;, block)  # writes a SEG-Y file called new_file.segy</code></pre><h2 id="Reading-out-of-core-SEG-Y-files"><a class="docs-heading-anchor" href="#Reading-out-of-core-SEG-Y-files">Reading out-of-core SEG-Y files</a><a id="Reading-out-of-core-SEG-Y-files-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-out-of-core-SEG-Y-files" title="Permalink"></a></h2><p>For SEG-Y files that do not fit into memory, JUDI provides the possibility to work with OOC data containers. First, <code>SegyIO</code> scans also available files and then creates a lookup table, including a summary of the most important SEG-Y header values. See <code>SegyIO&#39;s</code> <a href="https://github.com/slimgroup/SegyIO.jl/wiki/Scanning">documentation</a> for more information.</p><p>First we provide the path to the directory that we want to scan, as well as a string that appears in all the files we want to scan. For example, here we want to scan all files that contain the string <code>&quot;bp_observed_data&quot;</code>. The third argument is a list of SEG-Y headers for which we create a summary. For creating OOC <code>judiVectors</code>, <strong>always</strong> include the <code>&quot;GroupX&quot;</code>, <code>&quot;GroupY&quot;</code> and <code>&quot;dt&quot;</code> keyworkds, as well as the keywords that carry the source and receiver depth coordinates:</p><pre><code class="language-julia"># Specify direcotry to scan
path_to_data = &quot;/home/username/data_directory/&quot;

# Scan files in given directory and create OOC data container
container = segy_scan(path_to_data, &quot;bp_observed_data&quot;, [&quot;GroupX&quot;, &quot;GroupY&quot;, 
    &quot;RecGroupElevation&quot;, &quot;SourceDepth&quot;, &quot;dt&quot;])</code></pre><p>Depending of the number and size of the underlying files, this process can take multiple hours, but it only has to be executed once! Furthermore, <a href="https://github.com/slimgroup/SegyIO.jl/wiki/Scanning">parallel scanning</a> is supported as well. </p><p>Once we have scanned all files in the directory, we can create an OOC <code>judiVector</code> and source <code>Geometry</code> object as follows:</p><pre><code class="language-julia"># Create OOC judiVector
d_obs = judiVector(container; segy_depth_key=&quot;RecGroupElevation&quot;)

# Create OOC source geometry object
src_geometry = Geometry(container; key=&quot;source&quot;, segy_depth_key=&quot;SourceDepth&quot;)</code></pre><h2 id="Reading-and-writing-velocity-models"><a class="docs-heading-anchor" href="#Reading-and-writing-velocity-models">Reading and writing velocity models</a><a id="Reading-and-writing-velocity-models-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-and-writing-velocity-models" title="Permalink"></a></h2><p>JUDI does not require velocity models to be read or saved in any specific format. Any file format that allows reading the velocity model as a two or three-dimensional Julia array will work.</p><p>In our examples, we often use the <a href="https://github.com/JuliaIO/JLD.jl">JLD</a> or <a href="https://github.com/JuliaIO/HDF5.jl">HDF5</a> packages to read/write velocity models and the corresponing meta data (i.e. grid spacings and origins). If your model is a SEG-Y file, use the <code>segy_read</code> function from <code>SegyIO</code> as shown above.</p><ul><li>Create an example model to write and read:</li></ul><pre><code class="language-julia">n = (120, 100)
d = (10.0, 10.0)
o = (0.0, 0.0)
v = ones(Float32, n) .* 1.5f0
m = 1f0 ./ v.^2</code></pre><ul><li>Write a model as a <code>.jld</code> file:</li></ul><pre><code class="language-julia">using JLD

save(&quot;my_model.jld&quot;, &quot;n&quot;, n, &quot;d&quot;, d, &quot;o&quot;, o, &quot;m&quot;, m)</code></pre><ul><li>Read a model from a <code>.jld</code> file:</li></ul><pre><code class="language-julia"># Returns a Julia dictionary
M = load(&quot;my_model.jld&quot;)

n = M[&quot;n&quot;]
d = M[&quot;d&quot;]
o = M[&quot;o&quot;]
m = M[&quot;m&quot;]

# Set up a Model object
model = Model(n, d, o, m)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../preconditioners/">« Preconditioners</a><a class="docs-footer-nextpage" href="../helper/">Helper Functions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 4 August 2023 15:35">Friday 4 August 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
