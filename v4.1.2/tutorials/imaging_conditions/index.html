<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Imaging conditions in JUDI · JUDI documentation</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">JUDI documentation</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../about/">About</a></li><li><a class="tocitem" href="../../installation/">Installation</a></li><li><a class="tocitem" href="../../basics/">Getting Started</a></li><li><span class="tocitem">JUDI API</span><ul><li><a class="tocitem" href="../../abstract_vectors/">Abstract vectors</a></li><li><a class="tocitem" href="../../data_structures/">Data Structures</a></li><li><a class="tocitem" href="../../linear_operators/">Linear Operators</a></li><li><a class="tocitem" href="../../preconditioners/">Preconditioners</a></li><li><a class="tocitem" href="../../io/">Input/Output</a></li><li><a class="tocitem" href="../../helper/">Helper Functions</a></li></ul></li><li><a class="tocitem" href="../../inversion/">Inversion</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../01_intro/">Introduction to JUDI</a></li><li><a class="tocitem" href="../02_fwi_example_NLopt/">FWI with Quasi-Newton methods from the NLopt library</a></li><li><a class="tocitem" href="../03_constrained_fwi/">FWI Example</a></li><li><a class="tocitem" href="../04_judi_leading_edge_tutorial/">Full-Waveform Inversion - Part 3: optimization</a></li><li><a class="tocitem" href="../05_custom_misfit/">FWI with user provided misfit function</a></li><li><a class="tocitem" href="../06_automatic_differentiation/">Automatic differentiation with JUDI</a></li><li><a class="tocitem" href="../07_preconditionners/">Seismic preconditionners</a></li><li class="is-active"><a class="tocitem" href>Imaging conditions in JUDI</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Import-JUDI,-Linear-algebra-utilities-and-Plotting"><span>Import JUDI, Linear algebra utilities and Plotting</span></a></li><li class="toplevel"><a class="tocitem" href="#Create-a-JUDI-model-structure"><span>Create a JUDI model structure</span></a></li><li><a class="tocitem" href="#Create-discrete-parameters"><span>Create discrete parameters</span></a></li><li class="toplevel"><a class="tocitem" href="#Create-acquisition-geometry"><span>Create acquisition geometry</span></a></li><li><a class="tocitem" href="#Create-source-and-receivers-positions-at-the-surface"><span>Create source and receivers positions at the surface</span></a></li><li class="toplevel"><a class="tocitem" href="#Source-judiVector"><span>Source judiVector</span></a></li><li class="toplevel"><a class="tocitem" href="#Modeling"><span>Modeling</span></a></li><li class="toplevel"><a class="tocitem" href="#Model-and-image-data"><span>Model and image data</span></a></li><li class="toplevel"><a class="tocitem" href="#Inversion"><span>Inversion</span></a></li></ul></li><li><a class="tocitem" href="../quickstart/">Modeling and inversion with JUDI</a></li></ul></li><li><a class="tocitem" href="../../pysource/">Devito backend reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Imaging conditions in JUDI</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Imaging conditions in JUDI</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/slimgroup/JUDI.jl/blob/master/docs/src/tutorials/imaging_conditions.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Imaging-conditions-in-JUDI"><a class="docs-heading-anchor" href="#Imaging-conditions-in-JUDI">Imaging conditions in JUDI</a><a id="Imaging-conditions-in-JUDI-1"></a><a class="docs-heading-anchor-permalink" href="#Imaging-conditions-in-JUDI" title="Permalink"></a></h1><hr/><p>title: Overview of JUDI imaging conditions for inversion author: Mathias Louboutin date: October 2022 –-</p><p>This example script is written using <a href="https://github.com/JunoLab/Weave.jl">Weave.jl</a> and can be converted to different format for documentation and usage This example is converted to a markdown file for the documentation.</p><h1 id="Import-JUDI,-Linear-algebra-utilities-and-Plotting"><a class="docs-heading-anchor" href="#Import-JUDI,-Linear-algebra-utilities-and-Plotting">Import JUDI, Linear algebra utilities and Plotting</a><a id="Import-JUDI,-Linear-algebra-utilities-and-Plotting-1"></a><a class="docs-heading-anchor-permalink" href="#Import-JUDI,-Linear-algebra-utilities-and-Plotting" title="Permalink"></a></h1><pre><code class="language-julia">using JUDI, LinearAlgebra, PythonPlot</code></pre><h1 id="Create-a-JUDI-model-structure"><a class="docs-heading-anchor" href="#Create-a-JUDI-model-structure">Create a JUDI model structure</a><a id="Create-a-JUDI-model-structure-1"></a><a class="docs-heading-anchor-permalink" href="#Create-a-JUDI-model-structure" title="Permalink"></a></h1><p>In JUDI, a <code>Model</code> structure contains the grid information (origin, spacing, number of gridpoints) and the physical parameters. The squared slowness is always required as the base physical parameter for propagation. In addition, JUDI supports additional physical representations. First we accept <code>density</code> that can either be a direct input <code>Model(n, d, o, m, rho)</code> or an optional keyword argument <code>Model(n,d,o,m;rho=rho)</code>. Second, we also provide VTI/TTI kernels parametrized by the THomsen parameters that can be input as keyword arguments <code>Model(n,d,o,m; rho=rho, epsilon=epsilon;delta=delta,theta=theta,phi=phi)</code>. Because the thomsen parameters are optional the propagator wil lonloy use the ones provided.  For example <code>Model(n,d,o,m; rho=rho, epsilon=epsilon;delta=delta)</code> will infer a VTI propagation</p><h2 id="Create-discrete-parameters"><a class="docs-heading-anchor" href="#Create-discrete-parameters">Create discrete parameters</a><a id="Create-discrete-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Create-discrete-parameters" title="Permalink"></a></h2><pre><code class="language-julia"># Set up model structure
n = (601, 151)   # (x,y,z) or (x,z)
d = (10f0, 10f0)
o = (0., 0.)

# Velocity [km/s]
v = ones(Float32,n) .+ 0.5f0
v0 = ones(Float32,n) .+ 0.51f0
v[:, 101:end] .= 2f0
v0[:, 101:end] .= 2f0

# Slowness squared [s^2/km^2]
m = (1f0 ./ v).^2
m0 = (1f0 ./ v0).^2

# Setup model structure
nsrc = 1	# number of sources
model = Model(n, d, o, m)
model0 = Model(n, d, o, m0)</code></pre><pre><code class="language-none">Model (n=(601, 151), d=(10.0f0, 10.0f0), o=(0.0f0, 0.0f0)) with parameters 
(:m, :rho)</code></pre><h1 id="Create-acquisition-geometry"><a class="docs-heading-anchor" href="#Create-acquisition-geometry">Create acquisition geometry</a><a id="Create-acquisition-geometry-1"></a><a class="docs-heading-anchor-permalink" href="#Create-acquisition-geometry" title="Permalink"></a></h1><p>In this simple usage example, we create a simple acquisiton by hand. In practice the acquisition geometry will be defined by the dataset beeing inverted. We show in a spearate tutorial how to use <a href="https://github.com/slimgroup/SegyIO.jl">SegyIO.jl</a> to handle SEGY seismic datasets in JUDI.</p><h2 id="Create-source-and-receivers-positions-at-the-surface"><a class="docs-heading-anchor" href="#Create-source-and-receivers-positions-at-the-surface">Create source and receivers positions at the surface</a><a id="Create-source-and-receivers-positions-at-the-surface-1"></a><a class="docs-heading-anchor-permalink" href="#Create-source-and-receivers-positions-at-the-surface" title="Permalink"></a></h2><pre><code class="language-julia"># Set up receiver geometry
xrec = [1 * (n[1] - 1) * d[1] / 4]
yrec = [0f0] # WE have to set the y coordiante to zero (or any number) for 2D modeling
zrec = [d[1]]

# receiver sampling and recording time
timeD = 2500f0   # receiver recording time [ms]
dtD = 4f0    # receiver sampling interval [ms]

# Set up receiver structure
recGeometry = Geometry(xrec, yrec, zrec; dt=dtD, t=timeD, nsrc=nsrc)</code></pre><pre><code class="language-none">GeometryIC{Float32} wiht 1 sources</code></pre><p>The source geometry is a but different. Because we want to create a survey with <code>nsrc</code> shot records, we need to convert the vector of sources postions <code>[s0, s1, ... sn]</code> into an array of array [[s0], [s1], ...] so that JUDI understands that this is a set of indepednet <code>nsrc</code></p><pre><code class="language-julia">xsrc = 3 * (n[1] - 1) * d[1] / 4
ysrc = 0f0
zsrc = d[1]

# Set up source structure
srcGeometry = Geometry(xsrc, ysrc, zsrc; dt=dtD, t=timeD)</code></pre><pre><code class="language-none">GeometryIC{Float32} wiht 1 sources</code></pre><h1 id="Source-judiVector"><a class="docs-heading-anchor" href="#Source-judiVector">Source judiVector</a><a id="Source-judiVector-1"></a><a class="docs-heading-anchor-permalink" href="#Source-judiVector" title="Permalink"></a></h1><p>Finally, with the geometry defined, we can create a source wavelet (a simple Ricker wavelet here) a our first <code>judiVector</code> In JUDI, a <code>judiVector</code> is the core structure that represent a acquisition-geometry based dataset. This structure encapsulate the physical locations (trace coordinates) and corrsponding data trace in a source-based structure. for a given <code>judiVector</code> <code>d</code> then <code>d[1]</code> will be the shot record for the first source, or in the case of the source term, the first source wavelet and its positon.</p><pre><code class="language-julia"># setup wavelet
f0 = 0.015f0     # kHz
wavelet = ricker_wavelet(timeD, dtD, f0)
q = judiVector(srcGeometry, wavelet)</code></pre><pre><code class="language-none">judiVector{Float32, Matrix{Float32}} with 1 sources</code></pre><h1 id="Modeling"><a class="docs-heading-anchor" href="#Modeling">Modeling</a><a id="Modeling-1"></a><a class="docs-heading-anchor-permalink" href="#Modeling" title="Permalink"></a></h1><p>With our survey and subsurface model setup, we can now model and image seismic data. Linear Operators The core idea behind JUDI is to abstract seismic inverse problems in term of linear algebra. In its simplest form, seismic inversion can be formulated as</p><p class="math-container">\[\underset{\mathbf{m}}{\text{argmin}} \ \ \phi(\mathbf{m}) = \frac{1}{2} ||\mathbf{P}_r \mathbf{F}(\mathbf{m}) \mathbf{P}_s^{\top} \mathbf{q} - \mathbf{d} ||_2^2 \\
\text{   } \\
\nabla_{\mathbf{m}} \phi(\mathbf{m}) = \mathbf{J}(\mathbf{m}, \mathbf{q})^{\top} (\mathbf{P}_r \mathbf{F}(\mathbf{m}) \mathbf{P}_s^{\top} \mathbf{q} - \mathbf{d})\]</p><p>where <span>$\mathbf{P}_r$</span> is the receiver projection (measurment operator) and <span>$\mathbf{P}_s^{\top}$</span> is the source injection operator (adjoint of measurment at the source location). Therefore, we bastracted these operation to be able to define these operators</p><pre><code class="language-julia"># Setup operators
F = judiModeling(model, srcGeometry, recGeometry)
F0 = judiModeling(model0, srcGeometry, recGeometry)</code></pre><pre><code class="language-none">JUDI forward{Float32} propagator (src * rec * time) -&gt; (src * rec * time)</code></pre><h1 id="Model-and-image-data"><a class="docs-heading-anchor" href="#Model-and-image-data">Model and image data</a><a id="Model-and-image-data-1"></a><a class="docs-heading-anchor-permalink" href="#Model-and-image-data" title="Permalink"></a></h1><p>We first model synthetic data using our defined source and true model </p><pre><code class="language-julia"># Nonlinear modeling
dobs = F*q</code></pre><pre><code class="language-none">judiVector{Float32, Matrix{Float32}} with 1 sources</code></pre><h1 id="Inversion"><a class="docs-heading-anchor" href="#Inversion">Inversion</a><a id="Inversion-1"></a><a class="docs-heading-anchor-permalink" href="#Inversion" title="Permalink"></a></h1><p>Our main goal is to provide an inversion framework for seismic inversion. In this tutorial, we highlight the different imaging conditions available in JUDI. These imaging conditions are designed to enhanced properties in the gradient beneficial to the inversion problem such as the frequency content. Because these imaging conditions are intended tho be used in potential least-square problems, we also implemented (and test as part of our CI) their adjoint such that we can model linearized data with the JAcobian that correspond to the adjoint of the modified adjoint state crosscorelation imaging condition.</p><p>We compute now the FWI gradient with three different imaging conditions:</p><ul><li>&quot;as&quot; adjoint state imaging condition. This is the conventional cross-correlation adjoint state gradient.</li><li>&quot;isic&quot; that computes the inverse scattering imaging condition designed to provide reflections for LSRTM (high frequency content)</li><li>&quot;FWI&quot; that computes the complement of &quot;isic&quot; and brings up the low frequency content for velocity inversion</li></ul><p>These can be specified in the Option structure via <code>IC=&quot;as/isic/fwi</code></p><pre><code class="language-julia">fas, g_as = fwi_objective(model0, q, 0*dobs; options=Options(IC=&quot;as&quot;, space_order=12))
fisic, g_isic = fwi_objective(model0, q, 0*dobs; options=Options(IC=&quot;isic&quot;, space_order=12))
ffwi, g_fwi = fwi_objective(model0, q, 0*dobs; options=Options(IC=&quot;fwi&quot;, space_order=12))</code></pre><pre><code class="language-none">(32.988995f0, PhysicalParameter{Float32, 2} of size (601, 151) with origin 
(0.0f0, 0.0f0) and spacing (10.0f0, 10.0f0))</code></pre><p>We show below the sensitivity kernels for a single source-receiver pair highlighting the inversion properties of these imaging conditions</p><pre><code class="language-julia">ni(x) = 10 * x ./ norm(x, Inf)

fig = figure(figsize=(8, 12))
subplot(311)
imshow(ni(g_isic&#39;), cmap=&quot;seismic&quot;, aspect=&quot;auto&quot;, vmin=-1, vmax=1)
title(&quot;ISIC&quot;)
subplot(312)
imshow(ni(g_fwi&#39;), cmap=&quot;seismic&quot;,  aspect=&quot;auto&quot;, vmin=-1, vmax=1)
title(&quot;FWI&quot;)
subplot(313)
imshow(ni(g_as&#39;), cmap=&quot;seismic&quot;,  aspect=&quot;auto&quot;, vmin=-1, vmax=1)
title(&quot;Adjoint State&quot;)
tight_layout()
display(fig)</code></pre><p><img src="../figures/imaging_conditions_9_1.png" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../07_preconditionners/">« Seismic preconditionners</a><a class="docs-footer-nextpage" href="../quickstart/">Modeling and inversion with JUDI »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Saturday 24 May 2025 04:10">Saturday 24 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
